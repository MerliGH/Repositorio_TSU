<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identifícate</title>
    <link rel="stylesheet" href="components/footer/footer.css"> 
    <link rel="stylesheet" href="components/header/header2.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/estilos.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<div id="header-placeholder"></div>

<!-- Scripts -->
<script>
    $(function(){
        $("#header-placeholder").load("components/header/header2.html");
    });
</script>

<script src="components/header/header2.js"></script>


<body>
    <div id="header-placeholder"></div>
    <main>
        <div class="contenedor__todo">
            <div class="caja__trasera">
                <div class="caja__trasera-login">
                    <h3>¿Ya tienes una cuenta?</h3>
                    <p>Inicia sesión para entrar en la página</p>
                    <button id="btn__iniciar-sesion">Iniciar Sesión</button>
                </div>
                <div class="caja__trasera-register">
                    <h3>¿Aún no tienes una cuenta?</h3>
                    <p>Regístrate para que puedas iniciar sesión</p>
                    <button id="btn__registrarse">Regístrarse</button>
                </div>
            </div>

            <div class="contenedor__login-register">
               

                <form id="login-form" class="formulario__login">
                    <h2>Iniciar sesión</h2>
                    <input type="text" id="login-email" name="correo" placeholder="Correo electrónico">
                    <input type="password" id="login-password" name="contrasena" placeholder="Contraseña">
                    <button id="login-btn" type="button">Entrar</button>
                </form>



                <form id="register-form" class="formulario__register">
                    <h2>Regístrarse</h2>
                    <div class="form-group">
                        <label for="nombre">Nombre <span class="obligatorio">*</span></label>
                        <input type="text" id="nombre" name="nombre" maxlength="50" placeholder="Tu nombre" required>
                        <div id="error-nombre" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="apellidoPaterno">Apellido Paterno <span class="obligatorio">*</span></label>
                        <input type="text" id="apellidoPaterno" name="apellidoPaterno" maxlength="50" placeholder="Tu apellido paterno" required>
                        <div id="error-apellidoPaterno" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="apellidoMaterno">Apellido Materno <span class="obligatorio">*</span></label>
                        <input type="text" id="apellidoMaterno" name="apellidoMaterno" maxlength="50" placeholder="Tu apellido materno" required>
                        <div id="error-apellidoMaterno" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="tel" id="telefono" name="telefono" maxlength="15" placeholder="Tu teléfono">
                        <div id="error-telefono" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="correo">Correo Electrónico <span class="obligatorio">*</span></label>
                        <input type="email" id="correo" name="correo" maxlength="50" placeholder="Tu correo electrónico" required>
                        <div id="error-correo" class="error-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña <span class="obligatorio">*</span></label>
                        <input type="password" id="password" name="password" maxlength="50" placeholder="Tu contraseña" required>
                        <div id="error-password" class="error-message"></div>
                    </div>
                    <button type="submit">Registrarse</button>
                </form>
                <div class="aviso">
                    <a href="./index.html" class="cancelar">Cancelar</a>
                    <span class="obligatorio">*</span> Los campos son obligatorios.
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/script.js"></script>
    <script>
        $(document).ready(function() {
            $('#register-form').on('submit', function(event) {
                event.preventDefault();
                var valid = true;

                // Limpiar mensajes de error
                $(".error-message").text("");

                // Validar nombre
                var nombre = $("#nombre").val().trim();
                if (!nombre) {
                    $("#error-nombre").text("Por favor, llena el nombre.");
                    valid = false;
                }

                // Validar apellido paterno
                var apellidoPaterno = $("#apellidoPaterno").val().trim();
                if (!apellidoPaterno) {
                    $("#error-apellidoPaterno").text("Por favor, llena el apellido paterno.");
                    valid = false;
                }

                // Validar apellido materno
                var apellidoMaterno = $("#apellidoMaterno").val().trim();
                if (!apellidoMaterno) {
                    $("#error-apellidoMaterno").text("Por favor, llena el apellido materno.");
                    valid = false;
                }

                // Validar correo electrónico
                var correo = $("#correo").val().trim();
                if (!correo) {
                    $("#error-correo").text("Por favor, llena el correo electrónico.");
                    valid = false;
                } else if (!validateEmail(correo)) {
                    $("#error-correo").text("Por favor, ingresa un correo electrónico válido.");
                    valid = false;
                }

                // Validar contraseña
                var password = $("#password").val().trim();
                if (!password) {
                    $("#error-password").text("Por favor, ingresa una contraseña.");
                    valid = false;
                }

                // Validar teléfono (solo números)
                var telefono = $("#telefono").val().trim();
                if (telefono && isNaN(telefono)) {
                    $("#error-telefono").text("Solo se aceptan valores numéricos en el teléfono.");
                    valid = false;
                }

                if (valid) {
                    registrarEmpleado();
                } else {
                    alert("Por favor, completa todos los campos obligatorios de manera correcta.");
                }
            });

            function validateEmail(email) {
                var re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(String(email).toLowerCase());
            }

            function registrarEmpleado() {
                console.log("Función registrarEmpleado llamada");

                var nombre = $("#nombre").val();
                var apellidoPaterno = $("#apellidoPaterno").val();
                var apellidoMaterno = $("#apellidoMaterno").val();
                var telefono = $("#telefono").val();
                var correo = $("#correo").val();
                var password = $("#password").val();

                // Validar que el campo de teléfono esté vacío antes de la solicitud
                if (telefono === "") {
                    telefono = null;
                }

                var empleado = {
                    nombreCompleto: {
                        nombre: nombre,
                        apPaterno: apellidoPaterno,
                        apMaterno: apellidoMaterno
                    },
                    rol: "Empresa",
                    mina_id: "", // Puede ser vacío o null dependiendo del requerimiento
                    status: "true"
                };

                var usuario = {
                    empleado_id: null,
                    password: password,
                    telefono: telefono,
                    correo: correo,
                    status: "true"
                };

                $.ajax({
                    url: 'https://polliwog-desired-egret.ngrok-free.app/empleados/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(empleado),
                    success: function(response) {
                        if (response && response.id) {
                            usuario.empleado_id = response.id;
                            $.ajax({
                                url: 'https://polliwog-desired-egret.ngrok-free.app/usuarios/',
                                type: 'POST',
                                contentType: 'application/json',
                                data: JSON.stringify(usuario),
                                success: function(response) {
                                    alert('Registro completado con éxito.');
                                    // Aquí podrías redirigir al usuario o limpiar el formulario
                                    $('#register-form').trigger("reset");
                                },
                                error: function(xhr, status, error) {
                                    console.error("Error al registrar usuario:", status, error);
                                    alert('Favor de llenar el numero telefonico');
                                }
                            });
                        } else {
                            alert('Error al registrar empleado.');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error("Error al registrar empleado:", status, error);
                        alert('Error al registrar empleado.');
                    }
                });
            }

            $('#btn__registrarse').click(function() {
                $('.contenedor__login-register').addClass('active');
            });

            $('#btn__iniciar-sesion').click(function() {
                $('.contenedor__login-register').removeClass('active');
            });
        });
    
    
    
    
       
        $(document).ready(function() {
    $("#login-btn").on("click", function() {
        var correo = $("#login-email").val().trim();
        var contrasena = $("#login-password").val().trim();

        if (!correo || !contrasena) {
            alert("Por favor, ingresa tu correo electrónico y contraseña.");
            return;
        }

        iniciarSesion(correo, contrasena);
    });

    function iniciarSesion(correo, contrasena) {
        $.ajax({
    url: 'https://polliwog-desired-egret.ngrok-free.app/usuarios/',
    type: 'GET',
    success: function(response) {
        console.log(response); // Verifica la respuesta aquí

        // Verificar si la respuesta es un array
        if (Array.isArray(response)) {
            // Buscar el usuario en la lista
            var usuario = response.find(user => user.correo === correo && user.password === contrasena);

            if (usuario) {
                // Usuario encontrado, puedes proceder con el inicio de sesión
                console.log('Usuario encontrado:', usuario);
                // Aquí puedes redirigir al usuario, mostrar un mensaje, etc.
            } else {
                // Usuario no encontrado
                alert('Correo electrónico o contraseña incorrectos.');
            }
        } else {
            // La respuesta no es un array, informar del error
            alert('Error: la respuesta del servidor no es una lista de usuarios.');
        }
    },
    error: function(jqXHR, textStatus, errorThrown) {
        console.error("Error en la solicitud:", textStatus, errorThrown);
        alert("Error al recuperar los usuarios: " + textStatus + " - " + errorThrown);
    }
});


    }

    
});






    
    
    
    
    
    
    
    
    
    
    </script>



    <script src="assets/js/bootstrap.bundle.min.js"></script>
</body>
<div id="footer-container"></div>
    <div id="footer-placeholder"></div>

        <!-- Scripts -->
        <script>
            $(function(){
                $("#footer-placeholder").load("components/footer/footer.html");
            });
        </script>


        <script src="components/footer/footer.js"></script>
</html>
