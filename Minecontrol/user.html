<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Usuario</title>
    <link rel="stylesheet" href="./assets/css/registro.css" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <main>
        <section class="contact_form">
            <div class="formulario">
                <h1>Actualizar Usuario</h1>
                <form id="updateUserForm">
                    <div class="form-group">
                        <label for="userId">ID del Usuario <span class="obligatorio">*</span></label>
                        <input type="text" id="userId" name="userId" maxlength="50" placeholder="ID del usuario" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Nuevo Email <span class="obligatorio">*</span></label>
                        <input type="email" id="userEmail" name="userEmail" maxlength="100" placeholder="Nuevo email" required>
                    </div>
                    <button type="button" id="updateUserBtn">Actualizar Usuario</button>
                </form>
                <div class="aviso">
                    <span class="obligatorio">*</span> Todos los campos son obligatorios.
                </div>
            </div>
        </section>
        
        <section class="view_users">
            <div class="formulario">
                <h1>Lista de Usuarios</h1>
                <button id="obtenerUsuariosBtn">Obtener Usuarios</button>
                <ul id="listaUsuarios"></ul>
            </div>
        </section>
    </main>

    <script>
        $(document).ready(function() {
            $('#obtenerUsuariosBtn').click(function() {
                fetch('http://127.0.0.1:8000/usuarios/')
                    .then(response => response.json())
                    .then(data => {
                        const listaUsuarios = $('#listaUsuarios');
                        listaUsuarios.empty(); 

                        data.forEach(usuario => {
                            const listItem = $('<li>').text(`ID USUARIO: ${usuario.id}, Email: ${usuario.correo}`);
                            listaUsuarios.append(listItem);
                        });
                    })
                    .catch(error => console.error('Error:', error));
            });

            $('#updateUserBtn').click(function() {
                const userId = $('#userId').val();
                const newEmail = $('#userEmail').val();

                const updatedData = {
                    correo: newEmail
                };

                $.ajax({
                    url: `http://127.0.0.1:8000/usuarios/${userId}`,
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(updatedData),
                    success: function(response) {
                        alert("Usuario actualizado exitosamente");
                        $('#userId').val('');
                        $('#userEmail').val('');
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error en la actualización del usuario:", jqXHR.responseText);
                        alert("Error en la actualización del usuario: " + jqXHR.responseText);
                    }
                });
            });
        });
    </script>
</body>
</html>
