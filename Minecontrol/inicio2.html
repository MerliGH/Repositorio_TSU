<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identifícate</title>
    <link rel="stylesheet" href="components/footer/footer.css"> 
    <link rel="stylesheet" href="components/header/header2.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/estilos2.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="header-placeholder"></div>
    <main>
        <div class="contenedor__todo">
            <div class="caja__trasera">
                <div class="caja__trasera-login">
                    <h3>¿Ya tienes una cuenta?</h3>
                    <p>Inicia sesión para entrar en la página</p>
                    <button id="btn__iniciar-sesion">Iniciar Sesión</button>
                </div>
                <div class="caja__trasera-register">
                    <h3>¿Aún no tienes una cuenta?</h3>
                    <p>Regístrate para que puedas iniciar sesión</p>
                    <button id="btn__registrarse">Regístrarse</button>
                </div>
            </div>

            <div class="contenedor__login-register">
                <form id="login-form" class="formulario__login">
                    <h2>Iniciar Sesión</h2>
                    <input type="text" id="login-email" placeholder="Correo electrónico">
                    <input type="password" id="login-password" placeholder="Contraseña">
                    <button id="login-btn">Entrar</button>
                </form>

                <form id="register-form" class="formulario__register">
                    <h2>Regístrarse</h2>
                    <div class="form-group">
                        <label for="nombre">Nombre <span class="obligatorio">*</span></label>
                        <input type="text" id="nombre" name="nombre" maxlength="50" placeholder="Tu nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="apellidoPaterno">Apellido Paterno <span class="obligatorio">*</span></label>
                        <input type="text" id="apellidoPaterno" name="apellidoPaterno" maxlength="50" placeholder="Tu apellido paterno" required>
                    </div>
                    <div class="form-group">
                        <label for="apellidoMaterno">Apellido Materno <span class="obligatorio">*</span></label>
                        <input type="text" id="apellidoMaterno" name="apellidoMaterno" maxlength="50" placeholder="Tu apellido materno" required>
                    </div>
                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="tel" id="telefono" name="telefono" maxlength="15" placeholder="Tu teléfono">
                    </div>
                    <div class="form-group">
                        <label for="correo">Correo Electrónico <span class="obligatorio">*</span></label>
                        <input type="email" id="correo" name="correo" maxlength="50" placeholder="Tu correo electrónico" required>
                    </div>
                    
                    <button type="button" onclick="registrarEmpleado()">Registrarse</button>
                </form>
                <div class="aviso">
                    <a href="./index.html" class="cancelar">Cancelar</a>
                    <span class="obligatorio">*</span> Los campos son obligatorios.
                </div>
            </div>
        </div>
    </main>

    <script src="assets/js/script.js"></script>
    <script>
        $(function() {
            $("#header-placeholder").load("components/header/header2.html");
            $("#footer-placeholder").load("components/footer/footer.html");
        });

        function registrarEmpleado() {
            console.log("Función registrarEmpleado llamada");

            var nombre = $("#nombre").val();
            var apellidoPaterno = $("#apellidoPaterno").val();
            var apellidoMaterno = $("#apellidoMaterno").val();
            var telefono = $("#telefono").val();
            var correo = $("#correo").val();

            var empleado = {
                nombreCompleto: {
                    nombre: nombre,
                    apPaterno: apellidoPaterno,
                    apMaterno: apellidoMaterno
                },
                rol: "administrador",
                mina_id: "", // Puede ser vacío o null dependiendo del requerimiento
                status: "true"
            };

            var usuario = {
                empleado_id: null,
                password: "defaultPassword",
                telefono: telefono,
                correo: correo,
                status: "true"
            };

            $.ajax({
                url: 'https://polliwog-desired-egret.ngrok-free.app/empleados/',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(empleado),
                success: function(response) {
                    if (response && response.id) {
                        usuario.empleado_id = response.id;
                        $.ajax({
                            url: 'https://polliwog-desired-egret.ngrok-free.app/usuarios/',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(usuario),
                            success: function(usuarioResponse) {
                                if (usuarioResponse && usuarioResponse.id) {
                                    var cliente = {
                                        nombre: nombre,
                                        mina_id: [], // Lista vacía para clientes
                                        status: "true",
                                        empleado_id: response.id
                                    };

                                    $.ajax({
                                        url: 'https://polliwog-desired-egret.ngrok-free.app/clientes/',
                                        type: 'POST',
                                        contentType: 'application/json',
                                        data: JSON.stringify(cliente),
                                        success: function(clienteResponse) {
                                            if (clienteResponse && clienteResponse.id) {
                                                alert("¡Datos capturados! Continua en la siguiente ventana.");
                                                window.location.href = './index.html';
                                            } else {
                                                alert("Error: Cliente no registrado.");
                                            }
                                        },
                                        error: function(jqXHR, textStatus, errorThrown) {
                                            console.error("Error en el registro del cliente:", jqXHR.responseText);
                                            alert("Error en el registro del cliente: " + jqXHR.responseText);
                                        }
                                    });
                                } else {
                                    alert("Error: Usuario no registrado.");
                                }
                            },
                            error: function(jqXHR, textStatus, errorThrown) {
                                console.error("Error en el registro del usuario:", jqXHR.responseText);
                                alert("Error en el registro del usuario: " + jqXHR.responseText);
                            }
                        });
                    } else {
                        alert("Error: Empleado no registrado.");
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error("Error en el registro del empleado:", jqXHR.responseText);
                    alert("Error en el registro del empleado: " + jqXHR.responseText);
                }
            });
        }
    
    </script>

</body>
<div id="footer-container"></div>
    <div id="footer-placeholder"></div>

        <!-- Scripts -->
        <script>
            $(function(){
                $("#footer-placeholder").load("components/footer/footer.html");
            });
        </script>


        <script src="components/footer/footer.js"></script>

</html>

